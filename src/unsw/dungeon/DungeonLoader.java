package unsw.dungeon;

import java.io.FileNotFoundException;
import org.json.JSONArray;
import org.json.JSONObject;
import org.json.JSONTokener;

/**
 * Loads a dungeon from a .json file.
 *
 * <p>By extending this class, a subclass can hook into entity creation. This is useful for creating
 * UI elements with corresponding entities.
 */
public abstract class DungeonLoader {

  private JSONObject json;

  public DungeonLoader(String filename) throws FileNotFoundException {
    json = new JSONObject(new JSONTokener(getClass().getResourceAsStream("/dungeons/" + filename)));
  }

  /**
   * Parses the JSON to create a dungeon.
   *
   * @return
   */
  public Dungeon load() {
    int width = json.getInt("width");
    int height = json.getInt("height");

    Dungeon dungeon = new Dungeon(width, height);

    JSONArray jsonEntities = json.getJSONArray("entities");

    for (int i = 0; i < jsonEntities.length(); i++) {
      loadEntity(dungeon, jsonEntities.getJSONObject(i));
    }
    return dungeon;
  }

  private void loadEntity(Dungeon dungeon, JSONObject json) {
    String type = json.getString("type");
    int x = json.getInt("x");
    int y = json.getInt("y");

    Entity entity = null;
    switch (type) {
      case "player":
        Player player = new Player(dungeon, x, y);
        dungeon.setPlayer(player);
        onLoad(player);
        entity = player;
        break;
      case "wall":
        Wall wall = new Wall(x, y);
        onLoad(wall);
        entity = wall;
        break;
        // TODO Handle other possible entities
    }
    dungeon.addEntity(entity);
  }

  public abstract void onLoad(Entity player);

  public abstract void onLoad(Wall wall);

  // TODO Create additional abstract methods for the other entities

}
